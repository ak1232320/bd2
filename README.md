# Event Logger MVP

Минимальное веб-приложение для логирования событий (A/B CTA клики, heartbeat) в Google Sheets через Google Apps Script.

## Структура проекта

| Файл | Назначение |
|------|-----------|
| `index.html` | UI: поле ввода URL, кнопки событий, статус |
| `app.js` | Логика: localStorage, fetch-запросы, обработчики |
| `Code.gs` | Серверная часть для Google Apps Script |

## Быстрый старт

### 1. Настройка Google Apps Script

1. Создайте Google Таблицу.
2. Откройте **Расширения → Apps Script**.
3. Замените содержимое файла `Код.gs` на код из `Code.gs` этого проекта.
4. Убедитесь, что `doPost` — функция верхнего уровня (не вложена в другую функцию).
5. Нажмите **Начать развертывание → Новое развертывание**.
6. Тип: **Веб-приложение**.
7. Выполнять как: **Я**.
8. Доступ: **Все**.
9. Скопируйте полученный URL (заканчивается на `/exec`).

### 2. Запуск веб-приложения

1. Откройте `index.html` в браузере (или разместите на GitHub Pages).
2. Вставьте скопированный URL в поле ввода.
3. Нажмите **Save URL**.
4. Нажимайте кнопки **CTA A**, **CTA B**, **Heartbeat** — события будут записываться в таблицу.

## Формат данных в таблице

Лист `logs` создаётся автоматически. Столбцы:

| Столбец | Описание |
|---------|----------|
| `ts_iso` | Временная метка в формате ISO 8601 |
| `event` | Тип события: `cta_click` или `heartbeat` |
| `variant` | Вариант CTA: `A`, `B` или пусто |
| `userId` | Псевдоанонимный UUID из localStorage |
| `meta` | JSON-строка: `page`, `ua` (user agent) |

## Как это работает

- **CORS**: запросы отправляются как `application/x-www-form-urlencoded` без кастомных заголовков — это "simple request", не требующий preflight.
- **User ID**: генерируется через `crypto.randomUUID()` при первом визите и хранится в `localStorage` под ключом `uid`.
- **GAS URL**: сохраняется в `localStorage` под ключом `gas_url`.

## Деплой на GitHub Pages

1. Загрузите `index.html` и `app.js` в репозиторий GitHub.
2. Включите GitHub Pages в настройках репозитория (Settings → Pages → Source: main branch).
3. `Code.gs` на GitHub Pages не нужен — он используется только в Google Apps Script.

## Ограничения

- Нет аутентификации — любой с URL может отправлять события.
- Google Apps Script имеет лимиты: ~20 000 запросов в день для бесплатных аккаунтов.
- `crypto.randomUUID()` требует HTTPS или localhost.
- При изменении кода в Apps Script нужно создавать **новое** развертывание и обновлять URL.
